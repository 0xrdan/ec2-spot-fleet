# ec2-spot-fleet Configuration
# Copy this file to fleet.env and edit the values

# =============================================================================
# AWS SETTINGS (REQUIRED)
# =============================================================================

# AWS region for all resources
FLEET_REGION="us-east-1"

# SSH key pair name (created in AWS EC2 console)
# Find yours: aws ec2 describe-key-pairs --query 'KeyPairs[*].KeyName'
FLEET_KEY_NAME="my-keypair"

# Path to SSH private key (optional, defaults to ~/.ssh/${FLEET_KEY_NAME}.pem)
# FLEET_KEY_FILE="~/.ssh/my-key.pem"

# Security group ID (must allow SSH inbound on port 22)
# Find yours: aws ec2 describe-security-groups --query 'SecurityGroups[*].[GroupId,GroupName]'
FLEET_SECURITY_GROUP="sg-xxxxxxxxx"

# AMI ID - Amazon Machine Image to use
# Default: Ubuntu 22.04 Deep Learning AMI (has NVIDIA drivers)
FLEET_AMI_ID="ami-0f670b5aa9dce5d62"

# =============================================================================
# INSTANCE SETTINGS
# =============================================================================

# Project tag for all resources (used for filtering)
FLEET_PROJECT_TAG="my-project"

# Instance profile to use (defined in configs/profiles.json)
FLEET_PROFILE="default"

# Maximum number of instances allowed (safety limit)
FLEET_MAX_INSTANCES=10

# Availability zones to try (space-separated, in order of preference)
# FLEET_AVAILABILITY_ZONES="us-east-1a us-east-1b us-east-1c"

# =============================================================================
# WORKSPACE SETTINGS
# =============================================================================

# Remote workspace directory on instances
FLEET_WORKSPACE="/home/ubuntu/work"

# Local directory to sync to instances (optional)
# FLEET_SYNC_PATH="/path/to/local/project"

# Directories to exclude when syncing (space-separated)
FLEET_SYNC_EXCLUDE="target .git node_modules __pycache__ .venv"

# =============================================================================
# MONITORING SETTINGS
# =============================================================================

# Watch interval in seconds (default: 5 minutes)
FLEET_WATCH_INTERVAL=300

# Recovery timeout in seconds (default: 10 minutes)
FLEET_RECOVERY_TIMEOUT=600

# SSH connection timeout in seconds
FLEET_SSH_TIMEOUT=10

# =============================================================================
# EMAIL ALERTING (OPTIONAL)
# =============================================================================

# Email address to send alerts to
# FLEET_ALERT_EMAIL="alerts@example.com"

# SMTP settings for sending email
# FLEET_SMTP_HOST="smtp.example.com"
# FLEET_SMTP_PORT=587
# FLEET_SMTP_USER="sender@example.com"
# FLEET_SMTP_FROM="sender@example.com"

# Path to credentials file with SMTP_USER and SMTP_PASS
# This keeps passwords out of the main config file
# FLEET_SMTP_CREDENTIALS="/path/to/smtp-credentials.env"

# Slack webhook URL for notifications (optional)
# FLEET_SLACK_WEBHOOK="https://hooks.slack.com/services/xxx/yyy/zzz"

# =============================================================================
# JOB SETTINGS
# =============================================================================

# Job name (used for logging and process detection)
JOB_NAME="my-job"

# Build command to run on instance (optional)
# JOB_BUILD_CMD="cargo build --release"

# Whether to install Rust toolchain if not present
JOB_INSTALL_RUST=false

# Command to start the job (REQUIRED for job recovery)
# Available placeholders:
#   %NUM%        - Instance number
#   %START%      - Start value from instances.json
#   %END%        - End value from instances.json
#   %CHECKPOINT% - Checkpoint file path
#   %LOG%        - Log file path
#   %WORKSPACE%  - Workspace directory
# JOB_START_CMD="./run.sh --start %START% --end %END% --checkpoint %CHECKPOINT%"

# Process pattern to detect if job is running (for pgrep -f)
# JOB_PROCESS_PATTERN="run.sh"

# Log file pattern (%NUM% will be replaced with instance number)
JOB_LOG_PATTERN="/home/ubuntu/job_%NUM%.log"

# Setup command to run before starting job (optional)
# JOB_SETUP_CMD="./setup.sh --instance %NUM%"

# =============================================================================
# S3 SETTINGS (OPTIONAL - for checkpointing)
# =============================================================================

# S3 bucket for checkpoints and results
# JOB_S3_BUCKET="my-checkpoints"

# Checkpoint file prefix (instance number will be appended)
# JOB_CHECKPOINT_PREFIX="checkpoint_"

# Pattern to search for in S3 to detect results
# JOB_RESULT_PATTERN="results"

# Pattern to search for in logs to detect success
# JOB_SUCCESS_PATTERN="FOUND|SUCCESS|COMPLETE"

# =============================================================================
# ADVANCED SETTINGS
# =============================================================================

# State directory for tracking instance state
# FLEET_STATE_DIR=".state"

# Instance config file location
# FLEET_INSTANCES_FILE="configs/instances.json"

# Profiles config file location
# FLEET_PROFILES_FILE="configs/profiles.json"

# Custom user data script to run on instance launch (appended to default)
# FLEET_USER_DATA="apt-get install -y my-package"

# Environment variables to pass to job (space-separated list of var names)
# JOB_ENV_VARS="MY_VAR OTHER_VAR"
